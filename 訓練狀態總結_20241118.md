# 訓練狀態總結 - 2024年11月18日

## 總覽
- **已完成**: 7個實驗
- **運行中**: 3個實驗 (48M Flow單任務)
- **等待中**: 4個實驗 (48M多任務)

---

## ✅ 已完成的實驗

### 單任務基線模型

| 模型 | 參數量 | 輪數 | 峰值R | 最終R (最後10輪平均) | 狀態 |
|------|--------|------|--------|---------------------|------|
| **5M Baseline** | 5M | 15000 | **1222.15** | 29.92 | ✓ 完成 |
| **48M Baseline** | 48M | 15000 | **1253.89** ⭐ | 23.40 | ✓ 完成 |

**最佳**: 48M Baseline (峰值R: 1253.89)

### 5M Flow變體

| 變體 | Flow步數 | 輪數 | 峰值R | 最終R | 狀態 |
|------|----------|------|--------|-------|------|
| V1 | 2 | 20000 | 1132.89 | 1131.74 | ✓ 完成 |
| V2 | 4 | 20000 | **1197.40** ⭐ | 561.61 | ✓ 完成 |
| V3 | 8 | 20000 | 1137.49 | 22.87 | ✓ 完成 |

**最佳**: 5M Flow V2 (峰值R: 1197.40)  
**重要**: 所有5M Flow變體都**未能**超越5M基線 (1222.15)

---

## ⏳ 運行中的實驗 (48M單任務)

### 48M Flow V1 - substeps=2
- **任務ID**: 2322456
- **進度**: 10897/20000 (54.5%)
- **當前R**: 23.49
- **運行時間**: ~6h 37min
- **預計剩餘**: ~6小時
- **記憶體**: 256GB (已從128GB升級)

### 48M Flow V2 - substeps=4 ⭐ **重點關注**
- **任務ID**: 2322458
- **進度**: 5424/20000 (27.1%)
- **當前R**: 17.36
- **運行時間**: ~5h 15min
- **預計剩餘**: ~11小時
- **記憶體**: 256GB (已從128GB升級)
- **之前的峰值**: ~1209.81 (OOM前達到)
- **備註**: **最有希望超越48M基線的變體**

### 48M Flow V3 - substeps=8
- **任務ID**: 2322459
- **進度**: 3601/20000 (18.0%)
- **當前R**: 102.60 (早期表現良好)
- **運行時間**: ~5h 12min
- **預計剩餘**: ~14小時
- **記憶體**: 256GB
- **之前的峰值**: ~1182.21 (OOM前達到)

---

## 📋 等待中的實驗 (48M多任務)

以下4個任務已提交,在優先級隊列中等待:

1. **48M MT Baseline** (任務ID: 2322520)
2. **48M MT Flow V1** (任務ID: 2322521) - substeps=2
3. **48M MT Flow V2** (任務ID: 2322522) - substeps=4
4. **48M MT Flow V3** (任務ID: 2322523) - substeps=8

**配置**: 
- 使用 `train_multitask.py` + MT30配置
- 記憶體: 256GB
- 時間限制: 24小時

---

## 🔍 關鍵發現

### 1. 記憶體問題已解決 ✅
- 之前48M Flow運行時在128GB記憶體下發生OOM
- 所有重新提交的任務現在使用256GB記憶體
- 任務運行順利,無OOM問題

### 2. 5M vs 48M基線
- 48M基線達到**更高峰值** (1253.89 vs 1222.15)
- 兩者都成功完成15000輪
- 最終性能相對接近 (都在~20-30 R)

### 3. Flow性能表現
- 5M Flow變體**未能**超越5M基線
  - 最佳5M Flow (V2): 1197.40 
  - 5M Baseline: 1222.15 ❌
- 48M Flow V2顯示**潛力** (OOM前部分峰值1209.81)
- **需要等待48M Flow運行完成以進行最終比較**

### 4. 訓練配置修正
- 評估函數bug已修復 (使用環境獎勵而非世界模型獎勵)
- 基線horizon已修正為16 (之前錯誤設置為4)
- 多任務配置已修復 (使用正確的MT30配置)

---

## 📊 性能比較

### 當前最佳成績
1. **峰值R最高**: 48M Baseline (1253.89) ⭐
2. **最佳5M模型**: 5M Baseline (1222.15)
3. **最佳5M Flow**: 5M Flow V2 (1197.40)

### Flow vs Baseline (5M)
- Baseline **勝出**: 1222.15 > 1197.40
- Flow **未能**提供改進

### Flow vs Baseline (48M) - 待定
- 48M Baseline: 1253.89
- 48M Flow V2 (預期最佳): 待完成
- **關鍵問題**: Flow V2能否超越1253.89?

---

## 🎯 下一步計劃

### 立即行動 (任務運行期間)
1. ✅ 監控運行中的48M Flow任務 (~6-14小時剩餘)
2. ✅ 等待多任務作業開始 (隊列中等待)
3. ✅ 定期檢查日誌以發現任何錯誤

### 當前運行完成後
1. 📊 提取所有48M Flow變體的最終峰值R
2. 🔬 比較48M Flow V2 vs 48M Baseline (最重要的比較)
3. 📈 分析多任務基線性能
4. 🔄 比較多任務Flow變體與多任務基線
5. 📝 生成包含所有結果的最終評估報告

### 決策點

**如果 Flow V2 超越 Baseline**:
- 🎉 成功! Flow matching提供了改進
- 運行額外的評估集以確認
- 分析為什麼substeps=4最優

**如果 Flow V2 未超越 Baseline**:
- 🤔 分析為什麼Flow表現不佳
- 考慮: 不同的flow substep值、超參數調優
- 決定是否繼續Flow實驗或專注於基線

---

## 📁 重要文件

### 日誌位置
- 目錄: `PWM/logs/`
- 已完成: `train_*_baseline*_231414*.out`
- 運行中: `train_48M_flow_*_2322*.out`

### 配置文件
- 5M基線: `pwm_5M_baseline_final.yaml`
- 48M基線: `pwm_48M_baseline_single_task.yaml`
- Flow變體: `pwm_*_flow_v{1,2,3}_*.yaml`
- MT30配置: `config_mt30.yaml`

---

## ⏰ 時間估算

### 預計完成時間
- **48M Flow V1**: ~6小時 (最快)
- **48M Flow V2**: ~11小時 
- **48M Flow V3**: ~14小時 (最慢)
- **所有單任務**: ~14小時後
- **多任務開始**: 取決於隊列,可能數小時後
- **多任務完成**: 開始後~24小時

### 下次更新
**預計時間**: 2024年11月18日晚上或11月19日上午  
**內容**: 48M Flow單任務完整結果

---

## 💬 總結

### 已知結論
✅ 48M基線 > 5M基線 (峰值R)  
✅ 5M基線 > 所有5M Flow變體  
✅ 記憶體問題已解決 (256GB充足)  
✅ 評估bug已修復  

### 待定問題
❓ 48M Flow V2能否超越48M基線? (最關鍵)  
❓ Flow在48M規模下是否更有效?  
❓ 多任務設置下Flow的表現如何?  
❓ substeps=4是否為最優選擇?  

### 關鍵指標
**成功標準**: 48M Flow V2 峰值R > 1253.89  
**當前最佳**: 48M Baseline (1253.89)  
**最有希望的挑戰者**: 48M Flow V2 (部分峰值~1209)

---

**報告時間**: 2024-11-18 下午  
**狀態**: 7完成, 3運行中, 4等待中  
**下次檢查**: 11-19 上午
